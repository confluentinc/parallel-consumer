# Parallel Consumer Metrics

This document is intended to gather a few initial metrics that can be used to monitor the performance and health of the parallel consumer.

### Shard Manager

**Number Of Shards**

Gauge `pc_shards`

Overall number of sharded queues

**Shard Size**

Gauge `pc_shard_size{shard="shardName"}`

Number of records queued for processing in a given shard

**User Function Processing Time**

Timer `pc_user_function_processing_time`

Distribution of execution times for user-provided function for record processing (in seconds).

***Waiting Queue Time** - Not implemented yet

Timer `pc_waiting_queue_time_seconds`

Distribution of time records spend in the waiting for selection in the shard queue.

### Partition Manager

**Last Committed Offset**

Gauge `pc_last_committed_offset_partition{topic="topicName", partition="partitionNumber"}`

Last offset committed to the partition.

**Highest Completed Offset**

Gauge `pc_highest_completed_offset_partition{topic="topicName", partition="partitionNumber"}`

Offset of the last record successfully processed by the user function.

**Highest Sequential Offset (a.k.a Highest Committable Offset)**

Gauge `pc_highest_sequential_succeeded_offset_partition{topic="topicName", partition="partitionNumber"}`

Offset of the last record successfully processed by the user function, for which all previous records to this offset were marked as successfully processed.

**Number of Incomplete Offsets**

Gauge `pc_incomplete_offsets_partition{topic="topicName", partition="partitionNumber"}`

Gauge `pc_incomplete_offsets_total`

Number of record offsets not marked for committing.


**Highest Seen Offset**

Gauge `pc_highest_seen_offset_partition{topic="topicName", partition="partitionNumber"}`

The offset of the last record added to the shard processing queue.

**Current Epoch** - Not implemented

Gauge `pc_current_epoch_partition{topic="topicName", partition="partitionNumber"}`

Represents the epoch of the partition assignment, used to fence off invalid work from previous generations.


### Encoding Compression Stats

**Offsets Encoding Time**

Timer `pc_offsets_encoding_time`

Distribution of time spent encoding offsets metadata in seconds.

**Encoding Usage**

Counter `pc_encoding_usage{codec="BitSet|BitSetCompressed|BitSetV2Compressed|RunLength"}`

Distribution of the number of times a given encoding was used.

**Offsets Metadata Space Usage**

Gauge `pc_metadata_space_used`

Percentage distribution of ratio between space used by the encoded offsets metadata and maximum space for OffsetMetadata (which is 4096 bytes).

**Offsets Metadata Payload Ratio**

Gauge `pc_payload_ratio_used`
Percentage distribution of ratio between offset metadata payload size and offsets encoded.

**Offsets Metadata Compression Ratio** - Not implemented

Gauge `pc_metadata_compression_ratio`

Distribution of encoded offsets compression ratio.

### Work Manager

**Total In-flight Records**

Gauge `pc_inflight_records`

Total number of records currently being processed or waiting for retry.

**Total Records Awaiting Selection**

Gauge `pc_waiting_records`

Total number of records waiting to be selected for processing.

**Successfully Processed Records**

Counter `pc_processed_records{epoch="epochNumber", partition="partitionNumber", topic="topicName"}`

Total number of records successfully processed.

**Failed Records**

Counter `pc_failed_records{epoch="epochNumber", partition="partitionNumber", topic="topicName"}`

Total number of records failed to be processed.

**Slow Records** -- Not implemented

Counter `pc_slow_processed_records_total{partition="partitionNumber", topic="topicName"}`

Total number of records that spent more than the configured time threshold in the waiting queue. This setting defaults to 10 seconds.

### Broker Poller

**Status**

Gauge `pc_status{status="running|closing|closed|draining|paused|closed"}`

Parallel Consumer status check

**Number of Paused Partitions**

Gauge `pc_paused_partitions`

Number of partitions paused by the broker poller as backpressure mechanism.

